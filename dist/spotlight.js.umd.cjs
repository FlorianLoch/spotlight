(function(c,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(c=typeof globalThis<"u"?globalThis:c||self,h(c.Spotlight={}))})(this,function(c){"use strict";function h(e,t){e.classList.add(t)}function T(e,t){e.classList.remove(t)}function me(e,t,o){o?h(e,t):T(e,t)}function At(e){for(var t in e)t.startsWith("_s_")&&e.style.setProperty(t.substring(3),e[t])}function f(e,t,o){o=""+o,e["_s_"+t]!==o&&(e.style.setProperty(t,o),e["_s_"+t]=o)}let dt=0;function ve(e,t){t&&(f(e,"transition","none"),t()),dt||(dt=e.clientTop&&0),t&&f(e,"transition","")}function ye(e,t){e.firstChild.nodeValue=t}function pt(e,t){return(t||document).getElementsByClassName(e)}function y(e,t,o,l){$(!0,e,t,o,l)}function $(e,t,o,l,i){t[(e?"add":"remove")+"EventListener"](o,l,i||i===!1?i:!0)}function we(e,t){e.stopPropagation(),t&&e.preventDefault()}function Xt(e,t){const o=O("a"),l=t.src;o.href=l,o.download=l.substring(l.lastIndexOf("/")+1),e.appendChild(o),o.click(),e.removeChild(o)}function O(e){return document.createElement(e)}function ee(e,t){f(e,"display",t?"":"none")}function te(e,t){f(e,"visibility",t?"":"hidden")}function N(e,t){f(e,"transition",t?"":"none")}const oe=["info","theme","download","play","page","close","autofit","zoom-in","zoom-out","prev","next","fullscreen"],Bt={info:1,page:1,close:1,autofit:1,"zoom-in":1,"zoom-out":1,prev:1,next:1,fullscreen:1},w={BACKSPACE:8,ESCAPE:27,SPACEBAR:32,LEFT:37,RIGHT:39,UP:38,NUMBLOCK_PLUS:107,PLUS:187,DOWN:40,NUMBLOCK_MINUS:109,MINUS:189,INFO:73},u=O("div");u.id="spotlight",u.innerHTML="<div class=spl-spinner></div><div class=spl-track><div class=spl-scene><div class=spl-pane></div></div></div><div class=spl-header><div class=spl-page> </div></div><div class=spl-progress></div><div class=spl-footer><div class=spl-title> </div><div class=spl-description> </div><div class=spl-button> </div></div><div class=spl-prev></div><div class=spl-next></div>";const Ye={},Yt=O("video");function gt(e,t,o,l){let i,s;if(l!=="node"){const _=Object.keys(o);for(let ut=0,S;ut<_.length;ut++)if(S=_[ut],S.length>3&&S.indexOf("src")===0)if(l==="video"){const he=Ye[S];if(he){if(he>0){i=o[S];break}}else if(Yt.canPlayType("video/"+S.substring(3).replace("-","").toLowerCase())){Ye[S]=1,i=o[S];break}else Ye[S]=-1}else{const he=parseInt(S.substring(4),10);if(he){const Ut=Math.abs(t-he);(!s||Ut<s)&&(s=Ut,i=o[S])}}}return i||o.src||o.href||e.src||e.href}const ne={},_t=navigator.connection,Ft=window.devicePixelRatio||1;let d,p,F,I,P,q,Fe,Ie,E,R,be,le,Ce,H,ie,U,a,b,L,r,qe,se,A,ht,ke,ze,Se,Re,Ee,D,Me,He,De,Te,K,Ke,Ne,Pe,We,W,C,g,re,n,je=O("img"),ce,xe,j,ae=!1,Ge,Ve,Le,Je,Qe,Ze,mt,vt,x,Oe,X,G,m,k,$e,M,yt;y(document,"click",It);function et(){if(C)return;console.log("init"),C=document.body,ce=t("scene"),xe=t("header"),j=t("footer"),Ge=t("title"),Ve=t("description"),Le=t("button"),Je=t("prev"),Qe=t("next"),mt=t("page"),x=t("progress"),Oe=t("spinner"),re=[t("pane")],z("close",J),C[M="requestFullscreen"]||C[M="msRequestFullscreen"]||C[M="webkitRequestFullscreen"]||C[M="mozRequestFullscreen"]||(M=""),M?(yt=M.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),Ze=z("fullscreen",Ae)):oe.pop(),z("info",at),z("autofit",ge),z("zoom-in",rt),z("zoom-out",ct),z("theme",pe),vt=z("play",Y),z("download",ft),y(Je,"click",_e),y(Qe,"click",Q);const e=t("track");y(e,"mousedown",Tt),y(e,"mousemove",Pt),y(e,"mouseleave",it),y(e,"mouseup",it),y(e,"touchstart",Tt,{passive:!1}),y(e,"touchmove",Pt,{passive:!0}),y(e,"touchend",it),y(Le,"click",function(){Te?Te(a,r):De&&(location.href=De)});function t(o){return console.log("getOneByClass",o),ne[o]=pt("spl-"+o,u)[0]}}function z(e,t){console.log("addControl",e,t);const o=O("div");return o.className="spl-"+e,y(o,"click",t),xe.appendChild(o),ne[e]=o}function wt(e){console.log("dispatch",e);const t=ne[e];t&&(xe.removeChild(t),ne[e]=null)}function It(e){if(console.log("dispatch"),H)return;const t=e.target.closest(".spotlight");if(t){we(e,!0);const o=t.closest(".spotlight-group");L=pt("spotlight",o);for(let l=0;l<L.length;l++)if(L[l]===t){se=o&&o.dataset,Ct(l+1);break}}}function bt(e,t,o){L=e,t&&(se=t,ke=t.onshow,ze=t.onchange,Se=t.onclose,o=o||t.index),Ct(o)}function Ct(e){if(console.log("init_gallery",e),b=L.length,b){C||et(),ke&&ke(e);const t=re[0],o=t.parentNode;for(let l=re.length;l<b;l++){const i=t.cloneNode(!1);f(i,"left",l*100+"%"),o.appendChild(i),re[l]=i}g||(C.appendChild(u),ot()),a=e||1,N(ce),Ot(!0),M&&zt(),xt()}}function v(e,t){console.log("parse_option",e,t);let o=r[e];return typeof o<"u"?(o=""+o,o!=="false"&&(o||t)):t}function qt(e){console.log("apply_options",e),r={},se&&Object.assign(r,se),Object.assign(r,e.dataset||e),qe=r.media,Te=r.onclick,Me=r.theme,K=r.class,Ee=v("autohide",!0),A=v("infinite"),ht=v("progress",!0),D=v("autoslide"),He=v("preload",!0),De=r.buttonHref,Ke=D&&parseFloat(D)||7,U||Me&&pe(Me),K&&h(u,K),K&&ve(u);const t=r.control;if(t){const l=typeof t=="string"?t.split(","):t;for(let i=0;i<oe.length;i++)r[oe[i]]=!1;for(let i=0;i<l.length;i++){const s=l[i].trim();s==="zoom"?r["zoom-in"]=r["zoom-out"]=!0:r[s]=!0}}const o=r.animation;if(Ne=Pe=We=!o,W=!1,o){const l=typeof o=="string"?o.split(","):o;for(let i=0;i<l.length;i++){const s=l[i].trim();s==="scale"?Ne=!0:s==="fade"?Pe=!0:s==="slide"?We=!0:s&&(W=s)}}Re=r.fit}function tt(e){console.log("prepare_animation",e),e?ve(n,tt):(N(ce,We),f(n,"opacity",Pe?0:1),St(Ne&&.8),W&&h(n,W))}function Ue(e){if(console.log("init_slide",e),g=re[e-1],n=g.firstChild,a=e,n)Lt(),Re&&h(n,Re),tt(!0),W&&T(n,W),Pe&&f(n,"opacity",1),Ne&&f(n,"transform",""),f(n,"visibility","visible"),G&&(je.src=G),D&&nt(m);else{const t=X.media,o=v("spinner",!0);if(t==="video")fe(o,!0),n=O("video"),n.onloadedmetadata=function(){n===this&&(n.onerror=null,n.width=n.videoWidth,n.height=n.videoHeight,ue(),fe(o),Ue(e))},n.poster=r.poster,n.preload=He?"auto":"metadata",n.controls=v("controls",!0),n.autoplay=r.autoplay,n.playsinline=v("inline"),n.muted=v("muted"),n.src=X.src,g.appendChild(n);else if(t==="node"){n=X.src,typeof n=="string"&&(n=document.querySelector(n)),n&&(n._root||(n._root=n.parentNode),n._style||(n._style=n.getAttribute("style")),At(n),ue(),g.appendChild(n),Ue(e));return}else fe(o,!0),n=O("img"),n.onload=function(){n===this&&(n.onerror=null,fe(o),Ue(e),ue())},n.src=X.src,g.appendChild(n);n&&(o||f(n,"visibility","visible"),n.onerror=function(){n===this&&(Be(n),h(Oe,"error"),fe(o))})}}function fe(e,t){console.log("toggle_spinner",e,t),e&&me(Oe,"spin",t)}function kt(){return console.log("has_fullscreen"),document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}function Rt(){if(console.log("resize_listener"),ot(),n&&ue(),M){const e=kt();me(Ze,"on",e),e||zt()}}function zt(){ee(Ze,screen.availHeight-window.innerHeight>0)}function ot(){console.log("update_widget_viewport"),P=u.clientWidth,q=u.clientHeight}function ue(){console.log("update_media_viewport"),Fe=n.clientWidth,Ie=n.clientHeight}function St(e){console.log("update_scroll",e),f(n,"transform","translate(-50%, -50%) scale("+(e||E)+")")}function B(e,t){console.log("update_panel",e,t),f(g,"transform",e||t?"translate("+e+"px, "+t+"px)":"")}function de(e,t,o){console.log("update_slider",t,o),t?ve(ce,function(){de(e,!1,o)}):f(ce,"transform","translateX("+(-e*100+(o||0))+"%)")}function Et(e){console.log("toggle_listener",e),$(e,window,"keydown",Dt),$(e,window,"wheel",Kt),$(e,window,"resize",Rt),$(e,window,"popstate",Ht)}function Ht(e){console.log("history_listener"),g&&e.state.spl&&J(!0)}function Dt(e){if(console.log("key_listener"),g){const t=r["zoom-in"]!==!1;switch(e.keyCode){case w.BACKSPACE:t&&ge();break;case w.ESCAPE:J();break;case w.SPACEBAR:D&&Y();break;case w.LEFT:_e();break;case w.RIGHT:Q();break;case w.UP:case w.NUMBLOCK_PLUS:case w.PLUS:t&&rt();break;case w.DOWN:case w.NUMBLOCK_MINUS:case w.MINUS:t&&ct();break;case w.INFO:at();break}}}function Kt(e){if(console.log("wheel_listener"),g&&r["zoom-in"]!==!1){let t=e.deltaY;t=(t<0?1:t?-1:0)*.5,t<0?ct(e,e.clientX,e.clientY):t>0&&rt(e,e.clientX,e.clientY)}}function Y(e,t){console.log("play",e),(typeof e=="boolean"?e:!m)===!m&&(m=m?clearTimeout(m):1,me(vt,"on",m),t||nt(m))}function nt(e){console.log("animate_bar",e),ht&&(ve(x,function(){f(x,"transition-duration",""),f(x,"transform","")}),e&&(f(x,"transition-duration",Ke+"s"),f(x,"transform","translateX(0)"))),e&&(m=setTimeout(Q,Ke*1e3))}function V(){console.log("autohide"),Ee&&($e=Date.now()+2950,k||(h(u,"menu"),Mt(3e3)))}function Mt(e){console.log("schedule",e),k=setTimeout(function(){const t=Date.now();t>=$e?(T(u,"menu"),k=0):Mt($e-t)},e)}function lt(e){console.log("menu"),typeof e=="boolean"&&(k=e?k:0),k?(k=clearTimeout(k),T(u,"menu")):V()}function Tt(e){console.log("start"),we(e,!0),be=!0,le=!1,H=!1;let t=e,o=e.touches;R=o,o&&(o=o[0])&&(t=o),Ce=Fe*E<=P&&Ie*E<=q,F=t.pageX,I=t.pageY,N(g)}function it(e){if(console.log("end"),we(e),R=null,be){if(!le)lt();else{if(Ce&&le){const t=d<-(P/7)&&(a<b||A),o=t||d>P/7&&(a>1||A);(t||o)&&(de(a-1,!0,d/P*100),t&&Q()||o&&_e()),H&&p<-(q/4)?J():(d=0,p=0),B()}N(g,!0)}be=!1}}function Nt(e){return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))}function Wt(e){return[(e[0].clientX+e[1].clientX)*.5,(e[0].clientY+e[1].clientY)*.5]}function jt(e){if(r["zoom-in"]!==!1&&e&&e.length===2&&R&&R.length===2){const t=Nt(e)/Nt(R),o=Wt(e);st(t,o[0],o[1],!1)}return R=e,e&&e[0]}function Pt(e){if(console.log("move"),we(e),be){let t=jt(e.touches);if(t&&(e=t),!le){const o=F-e.pageX,l=I-e.pageY;H=Ce&&l>Math.abs(o)*1.15}if(H)p-=I-(I=e.pageY);else if(Ce)d-=F-(F=e.pageX);else{let o=(Fe*E-P)/2,l=Math.abs(o);o>0&&(d-=F-(F=e.pageX)),d>l?d=l:d<-l&&(d=-l),o=(Ie*E-q)/2,l=Math.abs(o),o>0&&(p-=I-(I=e.pageY)),p>l?p=l:p<-l&&(p=-l)}le=!0,B(d,p)}else V()}function Ae(e){console.log("fullscreen",e);const t=kt();(typeof e!="boolean"||e!==!!t)&&(t?document[yt]():u[M]())}function pe(e){console.log("theme",e),typeof e!="string"&&(e=U?"":Me||"white"),U!==e&&(U&&T(u,U),e&&h(u,e),U=e)}function ge(e){console.log("autofit",e),typeof e=="boolean"&&(ie=!e),ie=E===1&&!ie,me(n,"autofit",ie),f(n,"transform",""),E=1,d=0,p=0,ue(),N(g),B()}function st(e,t,o,l){let i=E*e;if(N(g,l),N(n,l),Lt(),i<=1){d=p=0,B(d,p),Xe(1);return}if(!(i>50)){if(o){const s=P/2,_=q/2;d=t-(t-d-s)*e-s,p=o-(o-p-_)*e-_}else d*=e,p*=e;B(d,p),Xe(i)}}function rt(e,t,o){console.log("zoom_in"),st(1/.65,t,o,!0)}function ct(e,t,o){console.log("zoom_out"),st(.65,t,o,!0)}function Xe(e){console.log("zoom",e),E=e||1,St()}function at(){console.log("info"),ae=!ae,te(j,ae)}function Lt(){console.log("disable_autoresizer"),ie&&ge()}function xt(){console.log("show_gallery"),history.pushState({spl:1},""),history.pushState({spl:2},""),N(u,!0),h(C,"hide-scrollbars"),h(u,"show"),Et(!0),ot(),V(),D&&Y(!0,!0)}function ft(){console.log("download",n),Xt(C,n)}function J(e){console.log("close",e),setTimeout(function(){C.removeChild(u),g=n=X=r=se=L=ke=ze=Se=Te=null,H=!1},200),T(C,"hide-scrollbars"),T(u,"show"),Ae(!1),Et(),history.go(e===!0?-1:-2),G&&(je.src=""),m&&Y(),n&&Be(n),k&&(k=clearTimeout(k)),U&&pe(),K&&T(u,K),Se&&Se()}function Be(e){if(console.log("checkout"),e._root)e.setAttribute("style",e._style||""),e._root.appendChild(e),e._root=e._style=null;else{const t=e.parentNode;t&&t.removeChild(e),e.onerror=null,e.src=""}}function _e(e){if(console.log("prev"),e&&V(),b>1){if(a>1)return Z(a-1);if(A)return de(b,!0),Z(b)}}function Q(e){if(console.log("next"),e&&V(),b>1){if(a<b)return Z(a+1);if(A)return de(-1,!0),Z(1);m&&Y()}}function Z(e){if(console.log("goto",e),e!==a){m?(clearTimeout(m),nt()):V();const t=e>a;return a=e,Ot(t),!0}}function Gt(e){console.log("prepare",e);let t=L[a-1];qt(t);const o=_t&&_t.downlink;let l=Math.max(q,P)*Ft;o&&o*1200<l&&(l=o*1200);let i;if(X={media:qe,src:gt(t,l,r,qe),title:v("title",t.alt||t.title||(i=t.firstElementChild)&&(i.alt||i.title))},G&&(je.src=G=""),He&&e&&(t=L[a])){const s=t.dataset||t,_=s.media;(!_||_==="image")&&(G=gt(t,l,s,_))}for(let s=0;s<oe.length;s++){const _=oe[s];console.log(_+": ",r[_]),ee(ne[_],v(_,Bt[_]))}}function Ot(e){if(console.log("setup_page",e),d=0,p=0,E=1,n)if(n.onerror)Be(n);else{let s=n;setTimeout(function(){s&&n!==s&&(Be(s),s=null)},650),tt(),B()}j&&te(j,!1),Gt(e),de(a-1),T(Oe,"error"),Ue(a),N(g),B();const t=X.title,o=v("description"),l=v("button"),i=t||o||l;i&&(t&&ye(Ge,t),o&&ye(Ve,o),l&&ye(Le,l),ee(Ge,t),ee(Ve,o),ee(Le,l),f(j,"transform",Ee==="all"?"":"none")),Ee||h(u,"menu"),ae=i,te(j,ae),te(Je,A||a>1),te(Qe,A||a<b),ye(mt,b>1?a+" / "+b:""),ze&&ze(a,r)}const Vt={init:et,theme:pe,fullscreen:Ae,download:ft,autofit:ge,next:Q,prev:_e,goto:Z,close:J,zoom:Xe,menu:lt,show:bt,play:Y,addControl:z,removeControl:wt};c.addControl=z,c.autofit=ge,c.close=J,c.default=Vt,c.download=ft,c.fullscreen=Ae,c.goto=Z,c.info=at,c.init=et,c.menu=lt,c.next=Q,c.play=Y,c.prev=_e,c.removeControl=wt,c.show=bt,c.theme=pe,c.zoom=Xe,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
